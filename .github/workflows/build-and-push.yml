name: Build and Push Docker Image

on:
  push:
    branches:
      - main  # Adjust to your main branch name

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Build Docker Image
        run: docker build -t my-node-app .

      - name: Build Status Check
        id: build
        run: echo "::set-output name=success::true"
        continue-on-error: true

      - name: Push Docker Image to ECR
        run: |
          if [ "$GITHUB_JOB_STATUS" == "success" ]; then
            docker tag my-node-app:latest <your-ecr-repo-url>:latest
            docker push <your-ecr-repo-url>:latest
          else
            echo "Build was not successful, skipping ECR push."
          fi
        env:
          <your-ecr-repo-url>: <your-ecr-repo-url>  # Replace with your ECR repository URL
