name: Build and Push Docker Image

on:
  push:
    branches:
      - main  

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Build Docker Image
        run: docker build -t node-web-app .

      - name: Build Status Check
        id: build
        run: echo "::set-output name=success::true"
        continue-on-error: true

      - name: Push Docker Image to ECR
        run: |
          if [ "$GITHUB_JOB_STATUS" == "success" ]; then
            docker tag node-web-app:latest public.ecr.aws/l0z9j4j6/authentiation:latest
            docker push public.ecr.aws/l0z9j4j6/authentiation:latest
          else
            echo "Build was not successful, skipping ECR push."
          fi
        env:
          <ecr-repo-url>: public.ecr.aws/l0z9j4j6/authentiation  
